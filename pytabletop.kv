#:kivy 1.0
#:import kivy kivy
#:import win kivy.core.window

# <Widget>:
#     canvas.after:
#         Color:
#             rgb: 1, 1, 0
        
#         Line:
#             rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#             dash_offset: 5
#             dash_length: 3

<FogOfWar>:
    Image:
        id: map
        source: root.source
        pos: 0, 0
        size: self.texture.size if self.texture else (100, 100)
        size_hint: None, None

        on_touch_down: root.on_map_touch_down(args[1])
        on_touch_move: root.on_map_touch_move(args[1])
        on_touch_up: root.on_map_touch_up(args[1])

        canvas.after:
            Color:
                rgba: 0, 0, 0, 0.8
            Rectangle:
                pos: self.pos
                size: self.size


<RevealRectangle>:
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    size_hint: None, None

    canvas.after:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            texture: self.texture
            size: self.size
            pos: self.pos

        Color:
            rgba: 1, 0, 0, 1
        Line:
            rectangle: self.x,self.y,self.width,self.height
            dash_offset: 5
            dash_length: 3


# <RevealEllipse>:
#     drag_rectangle: self.x, self.y, self.width, self.height
#     drag_timeout: 10000000
#     drag_distance: 0
#     size_hint: None, None

#     canvas.after:
#         Color:
#             rgba: 1, 1, 1, 1
#         Ellipse:
#             pos: self.pos
#             size: self.size
#             texture: self.texture


BoxLayout:
    orientation: 'vertical'

    Button:
        size_hint_y: None
        height: 100
        on_release: app.do_reveal()
        text: "reveal"

    FogOfWar:
        id: fog
        source: "grid.png"
        RevealRectangle:
            pos: 50, 750
            size: 200, 200
            size_hint: None, None
